


# FAST_LIO_SLAM 
# Fast_Lio+Scan context++

Integration of : 
1- FAST-LIO2 (Odometry): A computationally efficient and robust LiDAR-inertial odometry (LIO) package
2- SC-PGO (Loop detection and Pose-graph Optimization): Scan Context-based Loop detection and GTSAM-based Pose-graph optimization
Github : https://github.com/gisbi-kim/FAST_LIO_SLAM 

## 1. FAST-LIO (Fast LiDAR-Inertial Odometry):  
Fast LiDAR-Inertial Odometry is a computationally efficient and robust LiDAR-inertial odometry package. It fuses LiDAR feature points with IMU data 
using a tightly-coupled iterated extended Kalman filter to allow robust navigation in fast-motion, noisy or cluttered environments where degeneration occurs. 
This package address many key issues:

   1. Fast iterated Kalman filter for odometry optimization
   2. Automaticaly initialized at most steady environments
   3. Parallel KD-Tree Search to decrease the computation
   
For more details : https://github.com/hku-mars/FAST_LIO/blob/main/doc/Fast_LIO_2.pdf (FAST-LIO2: Fast Direct LiDAR-inertial Odometry ) 


## 2. Scan Context 
- Scan Context is a global descriptor for LiDAR point cloud, which is especially designed for a sparse and noisy point cloud acquired in outdoor environment.
- Scan Context++: Structural Place Recognition Robust to Rotation and Lateral Variations in Urban Environments
For more details : https://arxiv.org/pdf/2109.13494.pdf (Scan Context++: Structural Place Recognition Robust to Rotation and Lateral Variations in Urban Environments)


## Test Fast_Lio_Slam with Ouster OS1-128
   The below commands and the launch files are made for playing a bag recorded by Ouster OS1-128 , 
   but applicable for livox lidars in the same way (you could easily make your own launch files).
   
    # terminal 1: run FAST-LIO2 
    mkdir -p ~/catkin_fastlio_slam/src
    cd ~/catkin_fastlio_slam/src
    git clone https://github.com/gisbi-kim/FAST_LIO_SLAM.git
    git clone https://github.com/Livox-SDK/livox_ros_driver
    cd .. 
    catkin_make
    source devel/setup.bash
    roslaunch fast_lio mapping_ouster64_mulran.launch # setting for MulRan dataset 

    # open the other terminal tab: run SC-PGO
    cd ~/catkin_fastlio_slam
    source devel/setup.bash
    roslaunch aloam_velodyne fastlio_ouster64.launch # setting for MulRan dataset 
    
    
## ● Run real-time Lidar SLAM on your system
    # open the other terminal tab
    source myworkspace/devel/setup.bash 
    roslaunch ouster_ros ouster.launch sensor_hostname:=<sensor hostname> \
                                   metadata:=<path to metadata json>
where: 
<sensor hostname> :  can be the hostname (os-99xxxxxxxxxx) or IP of the sensor
<path to metadata json> : is the path you want to save sensor metadata to. You must provide a JSON filename at the end, not just a path to a directory.
   

## ● Playback a rosbag file to run SLAM in offline mode
    
    # open the other terminal tab
    source myworkspace/devel/setup.bash 
    roslaunch ouster_ros ouster.launch replay:=true metadata:=<path to metadata json>  
    
    # open the other terminal tab
    source myworkspace/devel/setup.bash
    rosbag play --clock <bag files ...> 
  
 
## Save the map : 
1. To save the map generated by FAST_LIO : 
Set pcd_save_enable in "catkin_fastlio_slam/src/FAST_LIO_SLAM/FAST-LIO/launch/launchfile" to "1". All the scans (in global frame) will be accumulated and saved to the file FAST_LIO/PCD/scans.pcd after the FAST-LIO is terminated
2. To save the map generated by FAST_LIO_SLAM (FAST_LIO + Scan Context++) : 
Set the right path in  "catkin_fastlio_slam/src/FAST_LIO_SLAM/SC-PGO/launch/launchfile" 
  
 
## Test&Results : 
    
- Lidar := Ouster-OS1 
- Ubuntu := 20.04
- ROS := Noetic 
- PCL  >= 1.8
- Eigen >= 3.3.4
- Bag file :=  mybag.bag (1.1 GB)
- Sensor configuration :=  sensor_config.json (71 kB) 
    
## Result of Fast_Lio_Slam (Fast_Lio + Scan context++)  : 
    
<p align="center">  ### OS1-128 Map Generation in RViz with Fast_Lio_Slam :  </p> 
    
   
  <p align="center">   
  <img src="https://user-images.githubusercontent.com/97898968/158196193-bf24c67f-d13d-409f-9310-3b075e288b1d.png?raw=true" alt="Sublime's custom image"/>
</p>

 ## Reconstruction of a point cloud map : 
   
 
you can recreate your map by this code python which support keyframe scan saver (as in .pcd) and provide a script reconstructs a point cloud map by merging the saved scans using the optimized poses. 
   
See the code here : https://github.com/gisbi-kim/FAST_LIO_SLAM/blob/bf975560741c425f71811c864af5d35aa880c797/SC-PGO/utils/python/makeMergedMap.py .

To install pypcd use this command:
    
          python3.x (use your python ver) -m pip install --user git+https://github.com/DanielPollithy/pypcd.git
  


  
  
  
    
